#!/usr/bin/env sh

drop_scripts () {
cat << SHAMIKO_PFS | base64 -d > /data/adb/modules/zygisk_shamiko/post-fs-data.sh
TU9ERElSPSIvZGF0YS9hZGIvbW9kdWxlcy96eWdpc2tfc2hhbWlrbyIKCiMgYmFzaWNhbGx5IHNo
YW1pa28gaGFzIHNvbWUgc29ydCBvZiB2ZXJpZmljYXRpb24KIyBpdCB3aWxsIGRldGVjdCBjaGFu
Z2VzIGF0IGluaXQsIGlmIGNoYW5nZTsgZmFpbAojIGJ1dCB3ZSBjYW4gaGlqYWNrIGl0cyBwb3N0
LWZzLWRhdGEuc2ggYW5kIHJ1biBjb2RlIGZyb20gaXQKIyB0aGVuIHJlc3RvcmUgb3Vyc2VsdmVz
IGFmdGVyCgojIGdldCB3cml0YWJsZSBkaXIKWyAtdyAvc2JpbiBdICYmIHJ3ZGlyPS9zYmluClsg
LXcgL2RlYnVnX3JhbWRpc2sgXSAmJiByd2Rpcj0vZGVidWdfcmFtZGlzawoKbWtkaXIgLXAgJHty
d2Rpcn0vc2hhbWlrb19oZWxwZXIKIyBiYWNrdXAgb3Vyc2VsZgpjcCAke01PRERJUn0vcG9zdC1m
cy1kYXRhLnNoICR7cndkaXJ9L3NoYW1pa29faGVscGVyL3Bvc3QtZnMtZGF0YS5zaAoKY2F0IDw8
IFNIQU1JSzBfQ0hBTExFTkdFIHwgYmFzZTY0IC1kID4gJHtyd2Rpcn0vc2hhbWlrb19oZWxwZXIv
Y2hhbGxlbmdlLnNoCkl5RXZkWE55TDJKcGJpOWxibllnYzJnS1RVOUVSRWxTUFNJdlpHRjBZUzlo
WkdJdmJXOWtkV3hsY3k5NmVXZHBjMnRmYzJoaGJXbHIKYnlJS0NpTWdaMlYwSUhkeWFYUmhZbXhs
SUdScGNncGJJQzEzSUM5elltbHVJRjBnSmlZZ2NuZGthWEk5TDNOaWFXNEtXeUF0ZHlBdgpaR1Zp
ZFdkZmNtRnRaR2x6YXlCZElDWW1JSEozWkdseVBTOWtaV0oxWjE5eVlXMWthWE5yQ2dvaklIUmhh
MlZ1SUdaeWIyMGdjbVYyClpXNTVKM01nZG1KdFpYUmhJR1pwZUdWeUNpTWdkMlVnZDJGcGRDQm1i
M0lnYkdGMWJtTm9aWElLZDJocGJHVWdkSEoxWlRzZ1pHOEsKSUNBZ0lHTjFjbkpsYm5SZlptOWpk
WE05SkNoa2RXMXdjM2x6SUhkcGJtUnZkeUI4SUdkeVpYQWdMVVVnSW0xRGRYSnlaVzUwUm05agpk
WE1pS1FvZ0lDQWdhV1lnWldOb2J5QWlKR04xY25KbGJuUmZabTlqZFhNaUlId2daM0psY0NBdGNT
QXRSU0FpYkdGMWJtTm9aWEo4CmJHRjNibU5vWVdseUlqc2dkR2hsYmdvZ0lDQWdJQ0FnSUdOd0lD
UjdjbmRrYVhKOUwzTm9ZVzFwYTI5ZmFHVnNjR1Z5TDJGamRHbHYKYmk1emFDQWtlMDFQUkVSSlVu
MHZZV04wYVc5dUxuTm9JQW9KWTJGMElDUjdjbmRrYVhKOUwzTm9ZVzFwYTI5ZmFHVnNjR1Z5TDNC
dgpjM1F0Wm5NdFpHRjBZUzV6YUNBK0lDUjdUVTlFUkVsU2ZTOXdiM04wTFdaekxXUmhkR0V1YzJn
S0lDQWdJQ0FnSUNCaWNtVmhhd29nCklDQWdaV3h6WlFvZ0lDQWdJQ0FnSUhOc1pXVndJREVLSUNB
Z0lHWnBDbVJ2Ym1VS0NpTWdSVTlHQ2c9PQpTSEFNSUswX0NIQUxMRU5HRQoKKCBzaCAke3J3ZGly
fS9zaGFtaWtvX2hlbHBlci9jaGFsbGVuZ2Uuc2ggKSAmCgpjYXQgPDwgU0hBTUlLT19BQ1RJT04g
fCBiYXNlNjQgLWQgPiAke3J3ZGlyfS9zaGFtaWtvX2hlbHBlci9hY3Rpb24uc2gKSXlFdmRYTnlM
MkpwYmk5bGJuWWdjMmdLQ20xclpHbHlJQzF3SUM5a1lYUmhMMkZrWWk5emFHRnRhV3R2THdvS2FX
WWdXeUF0WmlBdgpaR0YwWVM5aFpHSXZjMmhoYldscmJ5OTNhR2wwWld4cGMzUWdYVHNnZEdobGJn
b0pjbTBnTDJSaGRHRXZZV1JpTDNOb1lXMXBhMjh2CmQyaHBkR1ZzYVhOMENnbGxZMmh2SUNkYksx
MGdVMmhoYldscmJ5QnViM2NnYVc0Z1lteGhZMnRzYVhOMElHMXZaR1VuQ21Wc2MyVUsKQ1hSdmRX
Tm9JQzlrWVhSaEwyRmtZaTl6YUdGdGFXdHZMM2RvYVhSbGJHbHpkQW9KWldOb2J5QW5XeXRkSUZO
b1lXMXBhMjhnYm05MwpJR2x1SUhkb2FYUmxiR2x6ZENCdGIyUmxKd3BtYVFvS2MyeGxaWEFnTXdv
S1pYaHBkQW89ClNIQU1JS09fQUNUSU9OCgpjYXQgPDwgU0hBTUlLT19QRkQgfCBiYXNlNjQgLWQg
PiAke3J3ZGlyfS9zaGFtaWtvX2hlbHBlci9wb3N0LWZzLWRhdGEuc2gub3JpZwpUVTlFUkVsU1BT
UjdNQ1V2S24wS1RVOUVWVXhGWDAxSlRsOU5RVWRKVTB0ZlZrVlNVMGxQVGoweU56QXdOUXBOVDBS
VlRFVmZUVWxPClgwdFRWVVJmVmtWU1UwbFBUajB4TVRrd013cE5UMFJWVEVWZlRVbE9YMXBaUjBs
VFMxTlZYMVpGVWxOSlQwNDlNVGM0Q2sxQlIwbFQKUzE5V1JWSlRTVTlPUFNJa0tHMWhaMmx6YXlB
dFZpa2lDbWxtSUZzZ0xYb2dJaVJOUVVkSlUwdGZWa1ZTVTBsUFRpSWdYVHNnZEdobApiZ29nSUZw
WlIwbFRTMU5WWDFaRlVsTkpUMDQ5SkNobmNtVndJSFpsY25OcGIyNURiMlJsSUR3Z0wyUmhkR0V2
WVdSaUwyMXZaSFZzClpYTXZlbmxuYVhOcmMzVXZiVzlrZFd4bExuQnliM0FnZkNCelpXUWdKM012
ZG1WeWMybHZia052WkdVOUx5OW5KeWtLSUNCcFppQmIKSUNJa0tDOWtZWFJoTDJGa1lpOXJjM1Zr
SUMxV0tTSWdMV3gwSUNJa1RVOUVWVXhGWDAxSlRsOUxVMVZFWDFaRlVsTkpUMDRpSUYwZwpmSHdn
V3lBdGVpQWlKRnBaUjBsVFMxTlZYMVpGVWxOSlQwNGlJRjBnZkh3Z1d5QWlKRnBaUjBsVFMxTlZY
MVpGVWxOSlQwNGlJQzFzCmRDQWlKRTFQUkZWTVJWOU5TVTVmV2xsSFNWTkxVMVZmVmtWU1UwbFBU
aUlnWFRzZ2RHaGxiZ29nSUNCMGIzVmphQ0FpSkUxUFJFUkoKVWk5a2FYTmhZbXhsSWdvZ0lHWnBD
bVZzYVdZZ1d5QWlKRTFCUjBsVFMxOVdSVkpUU1U5T0lpQXRiSFFnSWlSTlQwUlZURVZmVFVsTwpY
MDFCUjBsVFMxOVdSVkpUU1U5T0lpQmRPeUIwYUdWdUNpQWdkRzkxWTJnZ0lpUk5UMFJFU1ZJdlpH
bHpZV0pzWlNJS1pta0sKU0hBTUlLT19QRkQKCiMgY2xlYW4gdXAKcm0gJHtNT0RESVJ9L2FjdGlv
bi5zaAooc2xlZXAgMiA7IGNhdCAke3J3ZGlyfS9zaGFtaWtvX2hlbHBlci9wb3N0LWZzLWRhdGEu
c2gub3JpZyA+ICR7TU9ERElSfS9wb3N0LWZzLWRhdGEuc2ggKSAmCgojIEVPRgo=
SHAMIKO_PFS

cat << SHAMIKO_ACTION | base64 -d > /data/adb/modules/zygisk_shamiko/action.sh
IyEvdXNyL2Jpbi9lbnYgc2gKCm1rZGlyIC1wIC9kYXRhL2FkYi9zaGFtaWtvLwoKaWYgWyAtZiAv
ZGF0YS9hZGIvc2hhbWlrby93aGl0ZWxpc3QgXTsgdGhlbgoJcm0gL2RhdGEvYWRiL3NoYW1pa28v
d2hpdGVsaXN0CgllY2hvICdbK10gU2hhbWlrbyBub3cgaW4gYmxhY2tsaXN0IG1vZGUnCmVsc2UK
CXRvdWNoIC9kYXRhL2FkYi9zaGFtaWtvL3doaXRlbGlzdAoJZWNobyAnWytdIFNoYW1pa28gbm93
IGluIHdoaXRlbGlzdCBtb2RlJwpmaQoKc2xlZXAgMwoKZXhpdAo=
SHAMIKO_ACTION

if [ -d /data/adb/modules_update/zygisk_shamiko ] ; then
	cat /data/adb/modules/zygisk_shamiko/post-fs-data.sh > /data/adb/modules_update/zygisk_shamiko/post-fs-data.sh
	cat /data/adb/modules/zygisk_shamiko/action.sh > /data/adb/modules_update/zygisk_shamiko/action.sh
fi
}



if [ -d /data/adb/modules/zygisk_shamiko ] ; then
	drop_scripts
else
	abort 'no shamiko'
fi

rm -rf /data/adb/modules/shamiko_helper /data/adb/modules_update/shamiko_helper
